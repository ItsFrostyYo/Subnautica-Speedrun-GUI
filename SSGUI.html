<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="x-ua-compatible" content="IE=Edge">
<title>Subnautica Speedrun GUI V3 by ItsFrosti</title>
<style>
    *{box-sizing:border-box;margin:0;font-family:Arial;}
    html,body{width:100%;height:100%;background:transparent;}
    body{overflow:hidden;}

    #container{
        background:url("Data/Background.png") center center / cover no-repeat;
        position:fixed;
        width:600px;
        height:400px;
    }
    #sidebar{
        float:left;
        width:25%;
        height:100%;
        background:#001a4d;
        display:flex;
        flex-direction:column;
        align-items:center;
        padding-top:60px;
        gap:25px;
        position:relative;
    }
    .sidebar_button{
        width:80%;height:50px;font-size:22px;
        border:none;border-radius:4px;
        background:#5ec8ff;color:#000;
        cursor:pointer;transition:0.3s;
    }
    .sidebar_button:hover{background:#7fd3ff;}

    .launch_button{
        width:40%;height:60px;font-size:28px;
        background:#28a745;color:white;
        position:absolute;bottom:20px;right:20px;
        border:none;border-radius:4px;cursor:pointer;
    }
    .launch_button:hover{background:#3cc65a;}

    .restart_button{width:30%;height:45px;font-size:16px;}
    .hotkey_button{width:35%;height:45px;font-size:16px;}
    .setup_macro_button{width:35%;height:45px;font-size:18px;}
    .save_deleter_button{width:40%;height:45px;font-size:14px;}

    .save_on { background:#ff6666 !important; color:#fff !important; }
    .save_off { background:#5ec8ff !important; color:#000 !important; }

    #sidebar_icon{
        position:absolute;bottom:25px;left:50%;
        transform:translateX(-50%);
        width:95px;height:auto;
    }
    .tab-content{
    float:left;
    width:75%;
    height:100%;
    padding:20px;
    overflow-y:auto;
    color:black;
    position:relative;
    background:transparent;  /* no white overlay */
    backdrop-filter:none;    /* no blur */
}

    h2{text-align:center;font-size:28px;margin-bottom:20px;color:#000;}

    select,input[type="text"]{
        background:#5ec8ff;border:none;color:#000;border-radius:4px;
    }
    select{width:80%;height:35px;font-size:16px;padding-left:5px;margin-bottom:12px;}
    input[type="text"]{width:80px;height:30px;font-size:14px;padding-left:5px;}

    #launch-group{position:absolute;bottom:90px;right:20px;width:40%;text-align:center;}
    #bottom-controls{position:absolute;bottom:20px;left:20px;display:flex;flex-direction:column;gap:10px;}
    #hotkey-row,#restart-row,#macro-row{display:flex;align-items:center;gap:10px;}
    #features-controls{position:absolute;bottom:20px;left:20px;width:calc(100% - 40px);display:flex;flex-direction:column;gap:10px;}

    #credits-icons{margin-top:30px;display:flex;justify-content:center;gap:40px;}
    #credits-icons img{width:80px;height:80px;background:transparent;cursor:pointer;}
</style>
<script>
function openTab(evt, tabId){
    document.querySelectorAll('.tab-content').forEach(t => t.style.display = 'none');
    document.getElementById(tabId).style.display = 'block';
}
</script>
</head>

<body>
<div id="container">
    <div id="sidebar">
        <button class="sidebar_button" onclick="openTab(event,'Game')">Game</button>
        <button class="sidebar_button" onclick="openTab(event,'Features')">Features</button>
        <button class="sidebar_button" onclick="openTab(event,'Credits')">Credits</button>
        <img id="sidebar_icon" src="Data/Icon.png" alt="Icon">
    </div>

    <!-- GAME VERSION TAB -->
    <div id="Game" class="tab-content" style="display:block;">
        <h2>Game Version Features</h2>
        <div id="bottom-controls">
            <div id="restart-row">
                <button id="toggleRNG" class="sidebar_button restart_button" style="width:calc(30% + 15px);">Toggle RNG Mod</button>
                <button id="restartGame" class="sidebar_button restart_button">Restart Game</button>
            </div>
            <div id="hotkey-row">
                <input type="text" id="restartHotkey" placeholder="Press a key">
                <button id="restartHotkeyBtn" class="sidebar_button hotkey_button">Set Hotkey</button>
            </div>
        </div>
        <div id="launch-group">
            <select id="versionChoice">
                <option value="2018">2018</option>
                <option value="Current">Current</option>
            </select>
        </div>
        <button id="launchBtn" class="launch_button">Launch</button>
    </div>

    <!-- FEATURES TAB -->
    <div id="Features" class="tab-content" style="display:none;">
        <h2>Additional Features</h2>
        <div id="features-controls">
            <button id="toggleSaveDeleter" class="sidebar_button save_deleter_button save_off">Hardcore Save Deleter: OFF</button>
            <button id="setupMacroBtn" class="sidebar_button setup_macro_button">Setup Macro</button>
            <div id="macro-row">
                <input type="text" id="macroHotkeyFeatures" placeholder="Press a key">
                <button id="macroHotkeyBtn" class="sidebar_button hotkey_button">Set Hotkey</button>
            </div>
        </div>
    </div>

    <!-- CREDITS TAB -->
    <div id="Credits" class="tab-content" style="display:none;">
        <h2>Credits</h2>
        <p>Subnautica Speedrun GUI V3 by ItsFrosti. Original idea from Lol869's Multi-Resets for Minecraft Bedrock Edition, Below is all my links for, Github, Youtube and Speedrun.com</p>
        <div id="credits-icons">
            <img src="Data/Github.png" alt="Github" id="githubBtn">
            <img src="Data/Youtube.png" alt="Youtube" id="youtubeBtn">
            <img src="Data/Src.png" alt="Speedrun.com" id="srcBtn">
        </div>
    </div>
</div>

<!-- ▼▼ NW.js → AHK command bridge ▼▼ -->
<script>
const fs = require('fs');
const path = require('path');
const cmdFile = path.join(process.cwd(), 'command.txt');

function sendCommand(cmd){
    try {
        fs.writeFileSync(cmdFile, cmd);
        console.log('Command sent:', cmd);
    } catch(err){
        console.error('Error writing command file:', err);
    }
}

// --- Game tab commands ---
document.getElementById('toggleRNG').onclick = () => sendCommand('toggle_rng');
document.getElementById('restartGame').onclick = () => sendCommand('restartgame');
document.getElementById('restartHotkeyBtn').onclick = () => {
    let key = document.getElementById('restartHotkey').value.trim();
    if(key) sendCommand('set_hotkey:' + key);
};
document.getElementById('launchBtn').onclick = () => {
    const version = document.getElementById('versionChoice').value;
    sendCommand(version === '2018' ? 'launch2018' : 'launchcurrent');
};

// --- Features tab commands ---
let saveDeleterOn = false;
document.getElementById('toggleSaveDeleter').onclick = () => {
    saveDeleterOn = !saveDeleterOn;
    const btn = document.getElementById('toggleSaveDeleter');
    if(saveDeleterOn){
        btn.textContent = "Hardcore Save Deleter: ON";
        btn.classList.replace('save_off','save_on');
        sendCommand('enable_savedeleter');
    } else {
        btn.textContent = "Hardcore Save Deleter: OFF";
        btn.classList.replace('save_on','save_off');
        sendCommand('disable_savedeleter');
    }
};
document.getElementById('setupMacroBtn').onclick = () => sendCommand('setup_macro');
document.getElementById('macroHotkeyBtn').onclick = () => {
    let key = document.getElementById('macroHotkeyFeatures').value.trim();
    if(key) sendCommand('set_macro_hotkey:' + key);
};

// --- Credits tab commands ---
document.getElementById('githubBtn').onclick = () => sendCommand('open_github');
document.getElementById('youtubeBtn').onclick = () => sendCommand('open_youtube');
document.getElementById('srcBtn').onclick = () => sendCommand('open_src');

// --- Hotkey capture ---
['restartHotkey','macroHotkeyFeatures'].forEach(id=>{
    document.getElementById(id).addEventListener('keydown', e=>{
        e.preventDefault();
        e.target.value = e.key;
    });
});

// --- Handle window close ---
window.onbeforeunload = () => {
    sendCommand('exit_script');
};
</script>
<!-- ▲▲ End command bridge ▲▲ -->
</body>
</html>
